// Renovate configuration for Ephemos
// Enhanced dependency management with security focus
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    "security:openssf-scorecard",
    ":dependencyDashboard",
    ":semanticCommits",
    ":separateMultipleMajorReleases"
  ],
  
  // Repository settings
  "repositories": ["sufield/ephemos"],
  "onboarding": false,
  "requireConfig": "required",
  
  // Security-focused configuration
  "vulnerabilityAlerts": {
    "enabled": true,
    "schedule": ["at any time"]
  },
  "osvVulnerabilityAlerts": true,
  "suppressNotifications": ["prIgnoreNotification"],
  
  // Go module configuration
  "gomod": {
    "enabled": true,
    "commitMessageTopic": "Go module {{depName}}",
    "semanticCommits": "enabled"
  },
  
  // Package groupings for 2025
  "packageRules": [
    {
      "groupName": "gRPC ecosystem",
      "matchPackagePatterns": [
        "^google\\.golang\\.org/grpc",
        "^google\\.golang\\.org/protobuf",
        "^google\\.golang\\.org/genproto"
      ],
      "schedule": ["before 6am on monday"],
      "labels": ["dependencies", "grpc", "security"],
      "reviewers": ["@sufield"]
    },
    {
      "groupName": "SPIFFE ecosystem", 
      "matchPackagePatterns": [
        "^github\\.com/spiffe/go-spiffe"
      ],
      "schedule": ["before 6am on monday"],
      "labels": ["dependencies", "spiffe", "security"],
      "reviewers": ["@sufield"]
    },
    {
      "groupName": "OpenTelemetry ecosystem",
      "matchPackagePatterns": [
        "^go\\.opentelemetry\\.io/"
      ],
      "schedule": ["before 6am on monday"],
      "labels": ["dependencies", "observability"]
    },
    {
      "groupName": "Security-critical packages",
      "matchPackagePatterns": [
        "^golang\\.org/x/crypto",
        "^golang\\.org/x/net",
        "^golang\\.org/x/sys"
      ],
      "schedule": ["at any time"],
      "labels": ["dependencies", "security-critical"],
      "reviewers": ["@sufield"],
      "automerge": false,
      "stabilityDays": 0
    },
    {
      "groupName": "Test dependencies",
      "matchPackagePatterns": [
        "^github\\.com/stretchr/testify"
      ],
      "labels": ["dependencies", "testing"],
      "automerge": true,
      "automergeType": "pr"
    }
  ],
  
  // Security and stability rules
  "separateMinorPatch": true,
  "separateMajorMinor": true,
  "stabilityDays": 3,
  "respectLatest": true,
  "ignoreUnstable": true,
  
  // Commit and PR configuration
  "semanticCommits": "enabled",
  "commitMessagePrefix": "chore(deps):",
  "commitMessageAction": "update",
  "commitMessageTopic": "{{depName}}",
  "commitMessageExtra": "to {{newVersion}}",
  
  // PR settings
  "labels": ["dependencies", "automated"],
  "assignees": ["@sufield"],
  "reviewers": ["@sufield"],
  "branchPrefix": "renovate/",
  "prTitle": "chore(deps): update {{depName}} to {{newVersion}}",
  "prBodyTemplate": "This PR updates {{depName}} from {{currentVersion}} to {{newVersion}}.\n\n**Security Analysis:**\n- OpenSSF Scorecard: {{#if scorecard}}{{scorecard.score}}{{else}}Not available{{/if}}\n- Vulnerability status: {{#if hasReleaseNotes}}See release notes{{else}}No known vulnerabilities{{/if}}\n\n**Changes:**\n{{#if releases}}{{#each releases}}{{#if releaseNotes}}{{releaseNotes}}{{/if}}{{/each}}{{/if}}\n\n**Verification:**\n- [ ] Security scan passed\n- [ ] Tests passing\n- [ ] No breaking changes\n\nAuto-generated by Renovate Bot ðŸ¤–",
  
  // Schedule configuration
  "schedule": ["before 6am on monday"],
  "timezone": "UTC",
  
  // Ignore patterns
  "ignorePaths": [
    "**/testdata/**",
    "**/*.pb.go",
    "**/vendor/**"
  ],
  
  // Update limits
  "prConcurrentLimit": 5,
  "prHourlyLimit": 2,
  
  // Advanced security features for 2025
  "osvVulnerabilityAlerts": true,
  "suppressNotifications": ["prIgnoreNotification"],
  "rebaseWhen": "conflicted",
  "lockFileMaintenance": {
    "enabled": true,
    "schedule": ["before 6am on sunday"]
  }
}